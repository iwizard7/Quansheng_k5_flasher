# –ü—Ä–æ—Ç–æ–∫–æ–ª Quansheng UV-K5

## –û–±–∑–æ—Ä

Quansheng UV-K5 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ USB-—Å–µ—Ä–∏–π–Ω—ã–π –ø–æ—Ä—Ç. –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ—Ä—Ç–∞**: 38400 –±–æ–¥
- **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: 8N1 (8 –±–∏—Ç –¥–∞–Ω–Ω—ã—Ö, –±–µ–∑ —á–µ—Ç–Ω–æ—Å—Ç–∏, 1 —Å—Ç–æ–ø-–±–∏—Ç)
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–º**: –ù–µ—Ç
- **Magic bytes**: `AB CD EF AB CD EF AB CD` (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö)

## –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∏
–ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º handshake —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å–≤—è–∑—å:

```
–ö–æ–º–∞–Ω–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ü—É—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞: []
- –û–¥–∏–Ω–æ—á–Ω—ã–π –±–∞–π—Ç: [00]
- ACK: [06]
- –ü—Ä–æ—Å—Ç–æ–µ Hello: [48 65 6C 6C 6F] ("Hello")
- UV-K5 Magic: [AB CD EF AB]
- –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞: [05]
```

### 2. Handshake –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –ú–µ—Ç–æ–¥ 1: Hello –∫–æ–º–∞–Ω–¥–∞
```
–û—Ç–ø—Ä–∞–≤–∫–∞: AB CD EF AB CD EF AB CD 14
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: 18 05 ...
```

#### –ú–µ—Ç–æ–¥ 2: –í—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
```
–û—Ç–ø—Ä–∞–≤–∫–∞: AB CD EF AB CD EF AB CD 18 05 20 15 01 17 25 01
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: 18 xx –∏–ª–∏ 06 xx
```

#### –ú–µ—Ç–æ–¥ 3: –ö–æ–º–∞–Ω–¥–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```
–û—Ç–ø—Ä–∞–≤–∫–∞: AB CD EF AB CD EF AB CD 05
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç)
```

## –ö–æ–º–∞–Ω–¥—ã —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–µ–Ω–∏–µ EEPROM
```
–§–æ—Ä–º–∞—Ç: AB CD EF AB CD EF AB CD 1B [–∞–¥—Ä–µ—Å_low] [–∞–¥—Ä–µ—Å_high] [–¥–ª–∏–Ω–∞]
–ü—Ä–∏–º–µ—Ä: AB CD EF AB CD EF AB CD 1B C0 1E 10
```

### –ß—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥)
```
–§–æ—Ä–º–∞—Ç: AB CD EF AB CD EF AB CD 1A [–∞–¥—Ä–µ—Å_low] [–∞–¥—Ä–µ—Å_high] [–¥–ª–∏–Ω–∞]
–ü—Ä–∏–º–µ—Ä: AB CD EF AB CD EF AB CD 1A C8 1E 02
```

### –ü—Ä–æ—Å—Ç–æ–µ —á—Ç–µ–Ω–∏–µ (–±–µ–∑ magic bytes)
```
–§–æ—Ä–º–∞—Ç: 1B [–∞–¥—Ä–µ—Å_low] [–∞–¥—Ä–µ—Å_high] [–¥–ª–∏–Ω–∞]
–ü—Ä–∏–º–µ—Ä: 1B C8 1E 02
```

## –ê–¥—Ä–µ—Å–∞ –ø–∞–º—è—Ç–∏ UV-K5

### –ö–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –±–∞—Ç–∞—Ä–µ–∏**: `0x1EC0` (16 –±–∞–π—Ç)
- **–¢–µ–∫—É—â–∏–π –≤–æ–ª—å—Ç–∞–∂ –±–∞—Ç–∞—Ä–µ–∏**: `0x1EC8` (2 –±–∞–π—Ç–∞)
- **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ RSSI**: `0x1F80`
- **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫–∞**: `0x1F40`
- **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø—Ä–∏–µ–º–Ω–∏–∫–∞**: `0x1F60`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ**: `0x0000`
- **–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏**: `0x2000`
- **–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: `0x0E70`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é**: `0x0F50`

### –ö–∞–Ω–∞–ª—ã –ø–∞–º—è—Ç–∏
- **–ù–∞—á–∞–ª–æ –∫–∞–Ω–∞–ª–æ–≤**: `0x0F30`
- **–†–∞–∑–º–µ—Ä –∫–∞–Ω–∞–ª–∞**: 16 –±–∞–π—Ç
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ**: 200 –∫–∞–Ω–∞–ª–æ–≤

## –ß—Ç–µ–Ω–∏–µ –≤–æ–ª—å—Ç–∞–∂–∞ –±–∞—Ç–∞—Ä–µ–∏

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —á—Ç–µ–Ω–∏—è –≤–æ–ª—å—Ç–∞–∂–∞
1. **UV-K5 Battery ADC**: `AB CD EF AB CD EF AB CD 1B C8 1E 02`
2. **–ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ**: `1B C8 1E 02`
3. **–°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**: `AB CD EF AB CD EF AB CD 05`
4. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ**: `AB CD EF AB CD EF AB CD 1A C8 1E 04`

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
UV-K5 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 12-bit ADC —Å –¥–µ–ª–∏—Ç–µ–ª–µ–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è:

```
–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: voltage = raw_value * 7.6 / 4096.0
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:
- voltage = raw_value * 3.3 / 1024.0  (10-bit ADC)
- voltage = raw_value * 3.3 / 4096.0  (12-bit ADC)
- voltage = raw_value * 0.00806       (—ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏–π)
- voltage = raw_value * 0.01611       (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π)
```

–î–∏–∞–ø–∞–∑–æ–Ω Li-ion –±–∞—Ç–∞—Ä–µ–∏: 2.5V - 4.5V

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫
- `deviceNotConnected`: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ
- `communicationError`: –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏
- `invalidResponse`: –ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç
- `checksumError`: –û—à–∏–±–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
- `timeout`: –¢–∞–π–º–∞—É—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
- `unsupportedOperation`: –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫: 3
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏: 100ms, 200ms, 300ms
- –û—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–∞—É–∑–∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏: 50ms

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ USB-–ø–æ—Ä—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ (38400)
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
5. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —ç–º–æ–¥–∑–∏ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏:
- üîÑ –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
- ‚ùå –û—à–∏–±–∫–∞
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- üì° –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
- üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
- üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è –≤–æ–ª—å—Ç–∞–∂–∞
```swift
// 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∏
let communicationWorks = try await testCommunication(interface: interface)

// 2. Handshake
try await performHandshake(interface: interface)

// 3. –ß—Ç–µ–Ω–∏–µ –≤–æ–ª—å—Ç–∞–∂–∞
let voltage = try await readBatteryVoltage(interface: interface)
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```swift
do {
    let voltage = try await readBatteryVoltage(interface: interface)
    print("–í–æ–ª—å—Ç–∞–∂: \(voltage)V")
} catch let error as K5ProtocolError {
    switch error {
    case .deviceNotConnected:
        print("–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ")
    case .communicationError:
        print("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏")
    // ... –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏
    }
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–µ –∏ –∞–Ω–∞–ª–∏–∑–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ UV-K5. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –Ω–∞ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏—è—Ö –ø—Ä–æ—à–∏–≤–∫–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑—å –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º.